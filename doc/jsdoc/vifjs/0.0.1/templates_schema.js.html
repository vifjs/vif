<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: templates/schema.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: templates/schema.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
    Evaluates a template and builds the interactivity schema.
    This makes the analysis of a new template much more efficient.
*/

import { attributeDirective } from "../directives/attr.js";
import { dataDirective } from "../directives/data.js";
import { eventDirective } from "../directives/event.js";
import { generateFunctionFromString } from "../evaluator/evaluator.js";
import {
    isXAttribute,
    isXElement,
    isXEventAttribute,
    isXTemplate,
} from "../utils/tests.js";
import { VIF } from "../utils/types.js";
import { templateDirective } from "../directives/template.js";
import {
    attributeNameSubstring,
    immutableChildrenOf,
} from "../utils/shortcuts.js";

/**
 * Create a xElement template schema
 * @param {NodeList} nodeList
 * @returns {boolean|VIF.Schema}
 */
export const createTemplateSchema = (nodeList) => {
    /** @type {VIF.Schema} */
    const schema = [];

    for (let x = 0; x &lt; nodeList.length; x++) {
        /** @type {HTMLElement} */
        let element = nodeList[x];
        const isxtemplate = isXTemplate(element);
        const isxelement = !isxtemplate &amp;&amp; isXElement(element);

        /** @type {VIF.Definition} */
        const definition = {
            // tagName: element.tagName, // DEBUG
            pos: x,
            schema: false,
            reactive: isxtemplate || isxelement,
            attrs: new Map(),
        };

        /** @type {number} */
        let index = element.attributes.length;

        // explore element attributes
        while (index--) {
            /** @type {HTMLElement.attribute} */
            const attr = element.attributes[index];

            if (isXAttribute(attr)) {
                /** @type {boolean} */
                const isxevent = isXEventAttribute(attr);
                /** @type {string} */
                const name = isxevent
                    ? attributeNameSubstring(attr, 5)
                    : attributeNameSubstring(attr, 2);

                /**
                 * get the expression function or the attribute value for ref, css or route
                 * @type {VIF.Expression|string}
                 */
                const expression =
                    name === "ref" || name === "css" || name === "route"
                        ? attr.value
                        : generateFunctionFromString(attr.value || "");

                /**
                 * extract the corresponding attribute or data directive
                 * @type {VIF.Directive}
                 */
                const directive = isxelement
                    ? dataDirective
                    : isxtemplate
                    ? templateDirective(attr.name)
                    : isxevent
                    ? eventDirective
                    : attributeDirective(attr.name);

                /** @type {VIF.Action} */
                const action = { expression, directive };

                /** @type {VIF.Attributes} */
                definition.attrs.set(name, action);

                // clear element attribute
                // if the element is an x-element we need to keep the attribute
                // because it will be used to bind the corresponding signal
                !isxelement &amp;&amp; element.removeAttribute(attr.name);
            }
        }

        // get the first of element.content.children | element.immutableChildren | element.children
        const childs = immutableChildrenOf(
            (element = element.content || element)
        );

        if (childs.length) {
            /**
             * If the element has children or immutableChildren
             * we build the definition of the element
             * @type {VIF.Schema}
             */
            definition.schema = createTemplateSchema(childs);
        }

        // if the definition is not empty we add it to the schema
        if (definition.attrs.size || definition.schema || isxelement) {
            schema.push(definition);
        }
    }

    /**
     * If there is no definition current schema return false
     * else return the array of definitions
     * @type {boolean|VIF.Schema}
     */
    return schema.length > 0 &amp;&amp; schema;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="xHandler.html">xHandler</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Vif">Vif</a></li><li><a href="global.html#attributeDirective">attributeDirective</a></li><li><a href="global.html#createCssSelector">createCssSelector</a></li><li><a href="global.html#createCssTemplateOrSelector">createCssTemplateOrSelector</a></li><li><a href="global.html#createEmptyTemplate">createEmptyTemplate</a></li><li><a href="global.html#createFlag">createFlag</a></li><li><a href="global.html#createLiteralTemplate">createLiteralTemplate</a></li><li><a href="global.html#createPart">createPart</a></li><li><a href="global.html#createReferenceArray">createReferenceArray</a></li><li><a href="global.html#createTemplateFragmentFromNodeList">createTemplateFragmentFromNodeList</a></li><li><a href="global.html#createTemplateFragmentFromString">createTemplateFragmentFromString</a></li><li><a href="global.html#createTemplateSchema">createTemplateSchema</a></li><li><a href="global.html#cssDirective">cssDirective</a></li><li><a href="global.html#cssNextId">cssNextId</a></li><li><a href="global.html#currentReactive">currentReactive</a></li><li><a href="global.html#dataDirective">dataDirective</a></li><li><a href="global.html#defaultDirective">defaultDirective</a></li><li><a href="global.html#define">define</a></li><li><a href="global.html#defineMemo">defineMemo</a></li><li><a href="global.html#disconnectReactive">disconnectReactive</a></li><li><a href="global.html#evaluatorMemo">evaluatorMemo</a></li><li><a href="global.html#eventDirective">eventDirective</a></li><li><a href="global.html#generateFunctionFromString">generateFunctionFromString</a></li><li><a href="global.html#i18n">i18n</a></li><li><a href="global.html#i18nMemo">i18nMemo</a></li><li><a href="global.html#i18nOnLoad">i18nOnLoad</a></li><li><a href="global.html#isDefined">isDefined</a></li><li><a href="global.html#isXAttribute">isXAttribute</a></li><li><a href="global.html#isXElement">isXElement</a></li><li><a href="global.html#isXEventAttribute">isXEventAttribute</a></li><li><a href="global.html#isXTemplate">isXTemplate</a></li><li><a href="global.html#locale">locale</a></li><li><a href="global.html#locales">locales</a></li><li><a href="global.html#navigate">navigate</a></li><li><a href="global.html#observe">observe</a></li><li><a href="global.html#observerDispacther">observerDispacther</a></li><li><a href="global.html#observerMemo">observerMemo</a></li><li><a href="global.html#reactive">reactive</a></li><li><a href="global.html#reconcile">reconcile</a></li><li><a href="global.html#refDirective">refDirective</a></li><li><a href="global.html#removePart">removePart</a></li><li><a href="global.html#showDirective">showDirective</a></li><li><a href="global.html#signal">signal</a></li><li><a href="global.html#templateDirective">templateDirective</a></li><li><a href="global.html#textDirective">textDirective</a></li><li><a href="global.html#translations">translations</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Fri Jan 19 2024 14:29:38 GMT+0100 (heure normale dâ€™Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
